## 关于官方题解所说的严谨性

此题的一种错误想法是：

第一个人选座位有3种情况：

选1位置，则第n个人坐在自己座位上的概率为 $\frac{1}{n} * 1$

选n位置，则概率为 $\frac{1}{n} * 0$

选中间位置x (1 < x < n)，则将第x人视作其正确座位在1号座位，则问题回到一开始的状态，只是规模变为$n-1$，概率为$\frac{n-2}{n} * a_{n-1}$。

于是

$$a_n = \frac{1}{n} + \frac{n-2}{n}*a_{n-1}$$

变形为$na_n = (n-2)a_{n-1} + 1$，这个可以从$a_2 = \frac{1}{2}$归纳得到后面都是$\frac{1}{2}$，
要求通项的话：两边同时乘$n - 1$，变为

$$n(n-1)a_n = (n-1)(n-2)a_{n-1} + n - 1$$

设$b_n = n(n-1)a_n$，则有 $b_n = b_{n-1} + n - 1，b_1 = 0$，然后能解出来 $b_n = \frac{n(n-1)}{2} (n \ge 2), b_1 = 0$，综合起来 $b_n = \frac{n(n-1)}{2} (n \ge 1)$

于是

$$a_n = \frac{1}{2} (n \ge 2), a_1 = 1$$

但是这种做法不严谨，题目隐含了一件事，座位的选择是按编号一个个选的，实际也必须这样，上述的想法只能算是笼统地得出了正确的答案。

那么该怎么考虑这个问题呢？

先定义两个东西，后面会看到为什么这么定义

记：n个人，其中最小编号的人和最小编号的座位不对应，且其它$n-1$个人与座位一一对应的情况下，第n个人坐上自己座位的概率为$g(n)$。以下称这个特殊人和特殊座位为"无座人"和"无人座"。


记：n个人，人的编号与座位的编号一一对应，最小编号的人的票丢了，按题目给定规则选座，第n个人坐上自己座位的概率记为$f(n)$

考虑$f(n)$，若第一个人选1号座位，则第n个人一定会做到n号座位；若其选最后一个座位，则第n个人一定坐不到n号座位；若其选$i$号座位($2 \le i \le n - 1$)，则按编号顺序一个个选，$[2, i - 1]$号人都会坐到自己的座位上，这些是确定的。到了第$i$个人时，他发现自己的座位被占用，而此时最小编号的1号座位和最小编号的人$i$不对应，而$[i+1, n]$号人与座位一一对应，于是，第n个人坐上自己位置的概率为$g(n - i + 1)$

于是有：

$$f(n) = \frac{1}{n} + \frac{1}{n}\sum \limits_{i=2}^{n-1}g(n - i + 1)$$

考虑$g(n)$，第一个人是"无座人"，他发现没有自己编号的座位，若其选中第一个座位(第一个座位是"无人座")，则其余人依次就坐；若其选中第n个座位，则第n个人一定坐不到自己座位；若其选中中间某个座位x(x是这些座位编号的第i个顺序统计量)，则编号大于"无座人"，小于x的人会依次就坐，到了第x号人时，x成为新的"无座人"，"无人座"不变，于是问题又变为$g(n - i + 1)$。

于是有：

$$g(n) = \frac{1}{n} + \frac{1}{n}\sum \limits_{i=2}^{n-1}g(n - i + 1)$$

由定义，$g(2) = \frac{1}{2}$，于是，用官方题解错一次下标再相减的方法可以得到

$$g(n) = \frac{1}{2}(n \ge 2)$$

于是可以得到

$$f(n) = \frac{1}{2}(n \ge 2)$$

$f(n)$和$g(n)$初值相同，递推关系相同，所以$f(n)$和$g(n)$本来就该是相等的。此外，回过头看$f(n)$和$g(n)$的定义，虽然在$f(n)$的定义中，第一个人有自己编号的座位，但是其票丢了，会随机选座位，其和$g(n)$定义中的"无座人"行为本身就是相同的，**$f(n)$和$g(n)$的定义是等价的**，所以$f(n)$=$g(n)$。

为什么要写这么麻烦？

因为官方题解这里跳了一步没说，当第一位乘客选择中间的第$i$号座位后，到了第$i$位乘客选时，其和$f(n)$有微妙的差别，第$i$个人不是丢了票，是座位被占据了，只是行为和丢票一样。$f(n)$应该是用$g(n)$的定义来递推。

知道$f(n)$和$g(n)$的两种情景等价之后，再回来推$f(n)$就清晰多了，选第一个位置$\frac{1}{n}$，选中间的位置$i$，$i$左边的部分会被坐，然后变为子问题$f(n - i + 1)$，选最后一个位置0，于是就能得到$f(n)$的递推关系了。

为什么官方题解说用 $f(n) = \frac{1}{n} + \frac{n-2}{n}*f(n-1)$ 来求是错的？

由上面的推导，实际成立的式子应该是

$$f(n) = \frac{1}{n} + \frac{1}{n}\sum \limits_{i=2}^{n-1}f(n - i + 1)$$

但是对于这题的情景，初值让 $\frac{n-2}{n}*f(n-1)$ 和 $\frac{1}{n}\sum \limits_{i=2}^{n-1}f(n - i + 1)$ 刚好相等，所以结果是正确的，但并不是成立 $f(n) = \frac{1}{n} + \frac{n-2}{n}*f(n-1)$ 这个关系。

---

# 补充
不止考虑最后一个人，任意一个人坐上自己座位的概率为多少？

以下编号从 $0$ 开始

## 平凡情况

$P(0) = \frac{1}{n}, P(1) = \frac{n - 1}{n}$

$0$ 号人的行为与其它人不同，其选择座位时，虽然 $0$ 号座位空着，其也会随机选择座位，所以 $P(0)$ 是单独的。

## 通式

考虑 $i$ 就位的概率，

若 $0$ 选了 $0$ 位置，则所有元素就位，此情况概率为 $\frac{1}{n}$

若 $0$ 选了 $[i + 1， n - 1]$ 之间的位置，$i$ 也一定就位，此情况总概率为 $\frac{n - i - 1}{n}$

若 $0$ 选了 $i$ ，$i$ 一定不能就位

若 $0$ 选了 $[1, i)$ 之间的某位置 $k$，则 $[1, k - 1]$ 一定都会就位，等到 $k$ 时，其位置已被占领，$k$ 会随机选一个，不妨认为 $k$ 的正确座位为 $0$ 号座位，$f(n, i)$ 变成子问题 $f (n - k，i - k)$，其中 $f$ 的第一个参数为新向量长度，第二个参数为 $i$ 的新顺序编号

综上有，

$f(n, i) = \frac{1}{n} + \frac{n - i - 1}{n} + \frac{1}{n} * \sum \limits_{1}^{i - 1} {f(n - k, i - k)}$

归纳，假设对前面的 $n, i$ 取值，有 $f(n, i) = \frac{n - i}{n - i + 1}$，现求 $f(n, i)$

由归纳假设，$f(n - k, i - k) = \frac{n - i}{n - i + 1}$ （**与 $k$ 无关！**）

则 $f(n, i) = \frac{n - i}{n} + \frac{1}{n} * (i - 1) * \frac{n - i}{n - i + 1}$

$= \frac{(n - i)(n - i + 1)}{n(n - i + 1)} + \frac{(n - i)(i - 1)}{n(n - i + 1)}$

$= \frac{(n - i)n}{n(n - i + 1)}$

$= \frac{n - i}{n - i + 1}$

于是有：$f(n, i) = \frac{n - i}{n - i + 1} (i \ge 1)$

## 结论

$P(0) = \frac{1}{n}$

$P(i) = \frac{n - i}{n - i + 1} (1 \le i \le n - 1)$